<!DOCTYPE html>
<html>
 <head th:replace = "~{layout/base :: head}">
  </head>
  
  <style th:replace="~{layout/base::css}">
</style>
<body>

 <div class="container-fluid">

  <!-- nav -->
   <nav th:replace="~{layout/base::navbar}"></nav>
  
   <!-- Offcanvas -->
   <div th:replace="~{layout/base::offcanvas}">
</div>

<div class="container mt-2">
        <h2 class="mb-4" th:text="${futbolista.id} ? 'Editar Futbolista' : 'Nuevo Futbolista'"></h2>


<form th:action="@{/futbolistas/guardar}" 
              th:object="${futbolista}" 
              method="post" 
              class=" mx-auto w-50 needs-validation" 
              novalidate>

            <input type="hidden" th:field="*{id}">
            
            <div class="col mb-2">
                <label class="form-label">Nombre *</label>
                <input type="text" th:field="*{nombre}" class="form-control" required>
                <div class="invalid-feedback">El nombre es obligatorio.
                </div>
            </div>
            
            <div class="col mb-2">
                <label class="form-label">Apellido *</label>
                <input type="text" th:field="*{apellido}" class="form-control" required>
                <div class="invalid-feedback">El apellido es obligatorio.</div>
            </div>
            
            <div class="col mb-2">
                <label class="form-label">Edad *</label>
                <input type="number" th:field="*{edad}" class="form-control" min="15" max="45" required>
            </div>
           <div class="col mb-2">
    <label class="form-label">Puesto *</label>
    <select th:field="*{puesto}" 
            class="form-select" 
            id="opcionPuesto" 
            required>
        <option value="">-- Seleccione --</option>
        <option th:each="p : ${puestos}" 
                th:value="${p.id}" 
                th:text="${p.nombre}"
                th:data-nombre="${p.nombre}">
        </option>
    </select>
</div>



<div id="camposArquero" style="display: none;">
    <div class="row">
        <div class="col mb-2">
            <label class="form-label">Total Atajadas</label>
            <input type="number" step="0.01" th:field="*{totalAtajadas}" class="form-control" />
        </div>
        <div class="col mb-2">
            <label class="form-label">Portería a Cero</label>
            <input type="number" step="0.01" th:field="*{porteriaACero}" class="form-control" />
        </div>
    </div>
    <div class="row">
        <div class="col-md mb-2">
            <label class="form-label">Goles en Contra</label>
            <input type="number" step="0.01" th:field="*{golesEnContra}" class="form-control" />
        </div>
        <div class="col-md mb-2">
            <label class="form-label">Penales Tapados</label>
            <input type="number" th:field="*{penalesTapados}" class="form-control" min="0" />
        </div>
    </div>
</div>
            <div class="col mb-2">
                <label class="form-label">Equipo</label>
                <select th:field="*{equipo}" class="form-select">
                    <option value="">-- Sin equipo --</option>
                    <option th:each="e : ${equipos}" 
                            th:value="${e.idEquipo}" 
                            th:text="${e.nombreEquipo}">
                    </option>
                </select>
            </div>
            <div class="col mb-2">
                <label class="form-label">País *</label>
                <select th:field="*{pais}" class="form-select" required>
                    <option value="">-- Seleccione un país --</option>
                    <option th:each="p : ${paises}" 
                            th:value="${p.id}" 
                            th:text="${p.nombre}">
                    </option>
                </select>
                <div class="invalid-feedback">Debe seleccionar un país.</div>
            </div>
            
           <div class="col mb-2">
    <label class="form-label">Segundo País (opcional)</label>
    <select th:field="*{segundoPais}" class="form-select">
        <option th:each="sp : ${segundosPaises}"
                th:value="${sp.id}"
                th:text="${sp.nombre}">
        </option>
    </select>
</div>

<div class="col mb-2">
                <label class="form-label">Goles</label>
                <input type="number" th:field="*{goles}" class="form-control" min="0" value="0">
            </div>
            
            <div class="col mb-2">
                <label class="form-label">Asistencias</label>
                <input type="number" th:field="*{asistencias}" class="form-control" min="0" value="0">
            </div>
            <div class="col mb-2">
                <label class="form-label">Partidos *</label>
                <input type="number" th:field="*{partidos}" class="form-control" min="0" required>
            </div>
            <div class="col mb-2">
                <label class="form-label">Tarjetas Amarillas</label>
                <input type="number" th:field="*{tarjetasAmarillas}" class="form-control" min="0" value="0">
            </div>
            <div class="col mb-5">
                <label class="form-label">Tarjetas Rojas</label>
                <input type="number" th:field="*{tarjetasRojas}" class="form-control" min="0" value="0">
            </div>
            
            <div class="col-mb-2">
                <button type="submit" class="btn btn-success me-2">
                    <i class="bi bi-hand-thumbs-up text-white me-1"></i> Guardar
                </button>
                <a th:href="@{/futbolistas/lista}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> Cancelar
                </a>
            </div>
            </form>
        </div>
</div>
<footer th:replace="~{layout/base::footer}">
  		</footer>
  		
  		<script>
document.addEventListener("DOMContentLoaded", function() {
    const puestoSelect = document.getElementById("opcionPuesto");
    const camposDiv = document.getElementById("camposArquero");

    function toggleCamposArquero() {
        const selectedOption = puestoSelect.options[puestoSelect.selectedIndex];
        const nombrePuesto = selectedOption ? selectedOption.dataset.nombre : "";

        if (nombrePuesto === "Arquero") {
            camposDiv.style.display = "block";
            // Hacer campos requeridos
            camposDiv.querySelectorAll("input").forEach(input => input.required = true);
        } else {
            camposDiv.style.display = "none";
            camposDiv.querySelectorAll("input").forEach(input => {
                input.required = false;
                input.value = ""; // limpiar
            });
        }
    }

    // Ejecutar al cargar y al cambiar
    toggleCamposArquero();
    puestoSelect.addEventListener("change", toggleCamposArquero);
});
</script>

<script>
  	// Example starter JavaScript for disabling form submissions if there are invalid fields
  		(() => {
  		  'use strict'

  		  // Fetch all the forms we want to apply custom Bootstrap validation styles to
  		  const forms = document.querySelectorAll('.needs-validation')

  		  // Loop over them and prevent submission
  		  Array.from(forms).forEach(form => {
  		    form.addEventListener('submit', event => {
  		      if (!form.checkValidity()) {
  		        event.preventDefault()
  		        event.stopPropagation()
  		      }

  		      form.classList.add('was-validated')
  		    }, false)
  		  })
  		})()
  		</script>
  		
  		<script>
  		document.addEventListener('DOMContentLoaded', function(){

  			const mensajeOK = '[[${guardadoCorrecto}]]';
  			
  			if (mensajeOK && mensajeOK.trim().length > 0){

  				Swal.fire({
  	  	  		  title: mensajeOK,
  	  	  		  icon: "success"
  	  	  		});
  			}
  			
});
  		
  		</script>
</body>
</html>